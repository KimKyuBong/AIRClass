# MediaMTX Configuration for Sub Nodes (template)
# __WEBRTC_UDP_PORT__ and __SERVER_IP__ are replaced at container start

api: yes
apiAddress: :9997

logLevel: debug
logFile: /tmp/mediamtx-sub.log

authMethod: http
authHTTPAddress: http://127.0.0.1:8000/api/auth/mediamtx
authHTTPExclude:
- action: api
- action: metrics

pathDefaults:
  source: rtmp://localhost/live/relay
  sourceOnDemand: false

# Global RTSP settings
rtspTransport: tcp
readTimeout: 20s

paths:
  "live/stream":
    source: rtsp://main:8554/live/stream
    sourceProtocol: tcp  # Force TCP to avoid UDP packet loss
    sourceOnDemand: no   # Keep connection alive always
    sourceRetry: yes     # Auto-reconnect on failure
    sourceRetryPause: 2s
    readUser: ''
    readPass: ''

# WebRTC - ports from env (no default 8189)
webrtc: yes
webrtcAddress: :8889
webrtcAllowOrigin: '*'
webrtcTrustedProxies: []
webrtcLocalUDPAddress: :__WEBRTC_UDP_PORT__
webrtcLocalTCPAddress: ':__WEBRTC_UDP_PORT__'
webrtcIPsFromInterfaces: false
webrtcIPsFromInterfacesList: []
webrtcAdditionalHosts: ['__SERVER_IP__']
# STUN helps NAT traversal; client and server can discover reachable addresses
webrtcICEServers: []
webrtcICEServers2:
  - url: stun:stun.l.google.com:19302

rtmp: yes
rtmpAddress: :1935

hls: yes
hlsAddress: :8888
hlsServerKey: server.key
hlsServerCert: server.crt
hlsAllowOrigin: '*'
hlsVariant: lowLatency
hlsSegmentCount: 7
hlsSegmentDuration: 1s
hlsPartDuration: 200ms
hlsSegmentMaxSize: 50M

record: false
