# MediaMTX Configuration for Sub Nodes
# Sub 노드: Main의 RTMP 스트림을 받아서 학생들에게 WebRTC로 배포

# API
api: yes
apiAddress: :9997

# Logging
logLevel: debug
logFile: /tmp/mediamtx-sub.log

# Authentication
authMethod: http
authHTTPAddress: http://127.0.0.1:8000/api/auth/mediamtx
authHTTPExclude:
- action: api
- action: metrics

# Environment variables
pathDefaults:
  source: rtmp://localhost/live/relay
  sourceOnDemand: no

# Paths (스트림 경로 정의)
# URL 경로와 일치: /live/stream/whep
paths:
  "live/stream":
    source: rtsp://main:8554/live/stream
    sourceOnDemand: yes
    sourceOnDemandStartTimeout: 10s
    sourceOnDemandCloseAfter: 10s
    
    # WebRTC 활성화 (학생들이 WHEP로 시청)
    readUser: ''
    readPass: ''

# WebRTC 설정
webrtc: yes
webrtcAddress: :8889
webrtcEncryption: no
webrtcAllowOrigin: '*'
webrtcTrustedProxies: []
webrtcLocalUDPAddress: :8189
webrtcLocalTCPAddress: ':8189'
webrtcIPsFromInterfaces: no
webrtcIPsFromInterfacesList: []
webrtcAdditionalHosts: []
webrtcICEServers:
  - url: stun:stun.l.google.com:19302

# RTMP 수신 (Main으로부터)
rtmp: yes
rtmpAddress: :1935
rtmpEncryption: no

# HLS 서빙
hls: yes
hlsAddress: :8888
hlsEncryption: no
hlsServerKey: server.key
hlsServerCert: server.crt
hlsAllowOrigin: '*'
hlsVariant: lowLatency
hlsSegmentCount: 7
hlsSegmentDuration: 1s
hlsPartDuration: 200ms
hlsSegmentMaxSize: 50M

# Recording (disabled for sub nodes)
record: no
